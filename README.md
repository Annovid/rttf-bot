# rttf-bot

## Установка зависимостей

```shell
python 3.12 -m venv venv
source venv/bin/activate
pip install poetry==1.8.4
poetry install
```

### Миграции

```shell
cd src
export POSTGRES_CONNECTION_STRING=postgresql://pguser:pgpass@localhost/rttf_bot
export DB_URL=postgresql://pguser:pgpass@localhost/rttf_bot
alembic upgrade head
```

## Приоритизация задач
### TODO:
###### Важное и срочное (Делай сейчас):
- [ ] Корректно отрабатывать при ошибке подключения к RTTF, DB, Loki и другим сервисам, если появятся
- [ ] Добавить алертинг, чтобы понимать, когда что-то идёт не так
###### Важное, но не срочное (Планируй):
###### Не важное, но срочное (Делегируй или делай позже):
###### Не важное и не срочное (Откладывай или откажись):
- [ ] Исправить варнинги при сборке ([warnings.log](docs%2Fwarnings.log))

---
### Расширение возможностей бота
- [ ] Подсчёт рейтинга при возможных результатах матча
- [ ] Определение победителя в шахпонге
- [ ] Нахождение предыдущих соперников в турнире
### Сделано:
- [x] Запускаться по крону
- [x] Добавить возможность грузить конфиг из базы данных
- [x] Добавить feedback
- [x] Перевести на VPS
- [x] Добавить базу данных
- [x] Добавить список команд через BotFather
- [x] Провести рефакторинг, чтобы избавиться от огромного файла
- [x] Отображать пользователей и турниры через ФИО и названия соответственно.
- [x] Лучше информировать пользователей о возможностях бота

## Деплой

1. Создание и заполнение файла `.env`

```shell
cp .env.example .env
```

Затем выставить необходимые переменные, как минимум токен от бота.

2. Поднять контейнеры (`rttf_bot_cron`, если необходимо)

```shell
docker-compose up -d --build rttf_bot_app rttf_bot_cron
```
